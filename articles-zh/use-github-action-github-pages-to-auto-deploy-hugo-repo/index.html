<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>使用 GitHub Action & GitHub Pages 自动部署 Hugo 博客</title><link rel=icon type=image/x-icon href=/img/favicon.ico><link rel=stylesheet href=https://mrpeng.tech/scss/style.min.7663471fb5b5b2e6d1166b30f4eea7393483c6cdd3965df890eb59b7c2ddeb4f.css><link rel=canonical href=https://pengshaw.github.io/></head><body><div class=header><div class=container><h1 class=logo><a href=https://mrpeng.tech>MrPeng.Tech</a></h1><input type=checkbox id=nav-checkbox>
<label for=nav-checkbox class=nav-toggle>Menu</label><nav class=nav-collapse><ul class=noList><li class="element first"><a href=https://mrpeng.tech/>Home</a></li><li class=element><a href=https://mrpeng.tech/articles/>Articles (EN)</a></li><li class=element><a href=https://mrpeng.tech/articles-zh/>Articles (中文)</a></li><li class=element><a href=https://mrpeng.tech/categories/>Categories</a></li><li class=element><a href=https://mrpeng.tech/tags/>tags</a></li><li class="element last"><a href=https://mrpeng.tech/about/>About</a></li></ul></nav></div></div><div id=content><div class=post><h1 class=postTitle>使用 GitHub Action & GitHub Pages 自动部署 Hugo 博客</h1><p class=meta>Published at 2023-06-24 | Last Update 2023-06-24</p><p>参考官方文档 <a href=https://gohugo.io/hosting-and-deployment/hosting-on-github/#build-hugo-with-github-action>Build Hugo With GitHub Action</a> 实现 GitHub Action & GitHub Pages 自动部署 Hugo 博客。</p><h3 id=1-初始化-hugo-博客>1. 初始化 Hugo 博客</h3><p>具体步骤如下:</p><ol><li><a href=https://gohugo.io/installation/>安装 Hugo</a></li><li><a href=https://git-scm.com/book/en/v2/Getting-Started-Installing-Git>安装 Git</a></li><li>创建 Hugo 项目, <code>hugo new site mrpeng.tech && cd mrpeng.tech</code></li><li>设置主题, <code>git init && git submodule add git@github.com:PengShaw/long-haul-hugo.git themes/long-haul-hugo</code></li><li>配置主题, <code>echo "theme = 'long-haul-hugo'" >> config.toml</code>, 具体参考<a href=https://github.com/PengShaw/long-haul-hugo>主题文档</a></li><li>开始写博客, <code>hugo new post_title.md</code></li></ol><h3 id=2-配置-github-action>2. 配置 Github Action</h3><p>自动部署 Hugo 博客需要配置两个 Github repo:</p><ul><li>一个 private repo 用于储存文章, 即上面创建的 Hugo 项目</li><li>一个 public repo, 用于 Github pages，一般是/.github.io</li></ul><p>用于 Github pages 的 public repo 需要设置 personal_token</p><p>github 头像下拉栏里进入<code>Setting - Developer Settings - Personal access tokens - Generate new token</code></p><p>在 private repo 中创建 <code>.github/workflows/hugo.yaml</code> 文件, 内容如下:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>name</span>: <span style=color:#ae81ff>github pages</span> <span style=color:#75715e># 名字自取</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>on</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>push</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>branches</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>main </span> <span style=color:#75715e># 当 main 分支发生 push 的时候，运行下面的jobs</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>jobs</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>deploy</span>: <span style=color:#75715e># 任务名自取</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>runs-on</span>: <span style=color:#ae81ff>ubuntu-latest	# 在 ubuntu-18.04 环境中运行任务</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>steps</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>actions/checkout@v2	# 引用a ctions/checkout 这个 action</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>submodules</span>: <span style=color:#66d9ef>true</span>  <span style=color:#75715e># 获取 submodule 主题 (true OR recursive)</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>fetch-depth</span>: <span style=color:#ae81ff>0</span>    <span style=color:#75715e># Fetch all history for .GitInfo and .Lastmod</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Setup Hugo	# 步骤名自取</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>peaceiris/actions-hugo@v2	# 用于在任务环境中获取 hugo 的action</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>hugo-version</span>: <span style=color:#e6db74>&#39;latest&#39;</span>	<span style=color:#75715e># 获取最新版本的 hugo</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Build</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>run</span>: <span style=color:#ae81ff>hugo --minify	# 使用 hugo 构建静态网页</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Deploy</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>peaceiris/actions-gh-pages@v3	# 一个自动发布 github pages 的 action</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>external_repository</span>: <span style=color:#ae81ff>PengShaw/pengshaw.github.io	# 发布到哪个repo</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>personal_token</span>: <span style=color:#ae81ff>${{ secrets.ACTION_ACCESS_TOKEN }}	# 发布到其他 repo 需要提供上面生成的 personal_token</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>publish_dir</span>: <span style=color:#ae81ff>./public	# 要发布哪个文件夹的内容，hugo 默认生成静态网页到 public 文件夹</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>publish_branch</span>: <span style=color:#ae81ff>main	# 发布到哪个branch</span>
</span></span></code></pre></div><p>在 private repo 中, 选择 <code>Settings - Secrets and variables - Actions - New repository secret</code>, 添加上面生成的 personal_token, 命名为 ACTION_ACCESS_TOKEN.</p><p>此时, 往 main 分支 push 新文章时 github actions 会自动生成静态博客并发布到 github pages 中。</p><div class="postNav clearfix"></div></div></div><div class=footer><div class=container><p class=copy>&copy; 2023-2023
<a href=https://mrpeng.tech/about>PengShaw</a>, Powered by
<a href=https://gohugo.io/>Hugo</a>, Theme originated from
<a href=https://github.com/ArthurChiao/arthurchiao.github.io>Arthur Chiao</a> &
            <a href=https://github.com/brianmaierjr/long-haul>Long Haul.</a></p><div class=footer-links><ul class=noList><li><a href=https://github.com/PengShaw><svg id="github" class="custom-icon" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 100 100" style="height:30px;width:30px"><circle class="outer-shape" cx="50" cy="50" r="48" style="opacity:1"/><path class="inner-shape" style="opacity:1" transform="translate(25,25) scale(0.5)" d="M50 1C22.938 1 1 22.938 1 50s21.938 49 49 49 49-21.938 49-49S77.062 1 50 1zM79.099 79.099c-3.782 3.782-8.184 6.75-13.083 8.823-1.245.526-2.509.989-3.79 1.387v-7.344c0-3.86-1.324-6.699-3.972-8.517 1.659-.16 3.182-.383 4.57-.67s2.855-.702 4.402-1.245 2.935-1.189 4.163-1.938c1.228-.75 2.409-1.723 3.541-2.919s2.082-2.552 2.847-4.067 1.372-3.334 1.818-5.455c.446-2.121.67-4.458.67-7.01.0-4.945-1.611-9.155-4.833-12.633 1.467-3.828 1.308-7.991-.478-12.489l-1.197-.143c-.829-.096-2.321.255-4.474 1.053s-4.57 2.105-7.249 3.924c-3.797-1.053-7.736-1.579-11.82-1.579-4.115.0-8.039.526-11.772 1.579-1.69-1.149-3.294-2.097-4.809-2.847s-2.727-1.26-3.637-1.532c-.909-.271-1.754-.439-2.536-.503s-1.284-.079-1.507-.048c-.223.031-.383.064-.478.096-1.787 4.53-1.946 8.694-.478 12.489-3.222 3.477-4.833 7.688-4.833 12.633.0 2.552.223 4.889.67 7.01.447 2.121 1.053 3.94 1.818 5.455s1.715 2.871 2.847 4.067 2.313 2.169 3.541 2.919c1.228.751 2.616 1.396 4.163 1.938 1.547.543 3.014.957 4.402 1.245 1.388.287 2.911.511 4.57.67-2.616 1.787-3.924 4.626-3.924 8.517v7.487c-1.445-.43-2.869-.938-4.268-1.53-4.899-2.073-9.301-5.041-13.083-8.823-3.782-3.782-6.75-8.184-8.823-13.083C9.934 60.948 8.847 55.56 8.847 50s1.087-10.948 3.231-16.016c2.073-4.899 5.041-9.301 8.823-13.083s8.184-6.75 13.083-8.823C39.052 9.934 44.44 8.847 50 8.847s10.948 1.087 16.016 3.231c4.9 2.073 9.301 5.041 13.083 8.823s6.75 8.184 8.823 13.083c2.143 5.069 3.23 10.457 3.23 16.016s-1.087 10.948-3.231 16.016C85.848 70.915 82.88 75.317 79.099 79.099z"/></svg></a></li><li><a href=mailto:hhxp9106@gmail.com><svg id="mail" class="custom-icon" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 100 100" style="height:30px;width:30px"><circle class="outer-shape" cx="50" cy="50" r="48" style="opacity:1"/><path class="inner-shape" style="opacity:1" transform="translate(25,25) scale(0.5)" d="M50 1C22.938 1 1 22.938 1 50s21.938 49 49 49 49-21.938 49-49S77.062 1 50 1zM25.5 25.5h49c.874.0 1.723.188 2.502.542L50 57.544 22.998 26.041C23.777 25.687 24.626 25.499 25.5 25.5zM19.375 68.375v-36.75c0-.128.005-.256.014-.383l17.96 20.953L19.587 69.958C19.448 69.447 19.376 68.916 19.375 68.375zM74.5 74.5h-49c-.541.0-1.072-.073-1.583-.212l17.429-17.429L50 66.956l8.653-10.096 17.429 17.429C75.572 74.427 75.041 74.5 74.5 74.5zm6.125-6.125c0 .541-.073 1.072-.211 1.583L62.652 52.195l17.96-20.953c.008.127.014.255.014.383L80.625 68.375z"/></svg></a></li></ul></div></div></div></body></html>